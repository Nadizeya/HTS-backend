### HTS Backend API Tests
### Use VS Code REST Client extension to run these requests
### Install: https://marketplace.visualstudio.com/items?itemName=humao.rest-client

@baseUrl = http://localhost:3000
@accessToken = your_access_token_here
@refreshToken = your_refresh_token_here

###############################################
# Health Check & Basic Routes
###############################################

### Health Check
GET {{baseUrl}}/health

### API Status
GET {{baseUrl}}/api

###############################################
# Authentication - Login & Registration
###############################################

### Register New User
# @name register
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "employeecode": "N002",
  "fullname": "Jane Doe",
  "role": "nurse",
  "phone": "0812345679",
  "password": "123456"
}

### Login with Employee Code (Nurse)
# @name login
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "employeecode": "N001",
  "password": "123456"
}

### Login as Admin
# @name adminLogin
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "employeecode": "A001",
  "password": "admin123"
}

### Login as Porter
# @name porterLogin
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "employeecode": "P001",
  "password": "123456"
}

### Extract Access Tokens
@authToken = {{login.response.body.data.token}}
@refreshTokenFromLogin = {{login.response.body.data.refreshToken}}
@adminToken = {{adminLogin.response.body.data.token}}
@porterToken = {{porterLogin.response.body.data.token}}

### Get Current User Info
GET {{baseUrl}}/api/auth/me
Authorization: Bearer {{authToken}}

### Refresh Access Token
# @name refresh
POST {{baseUrl}}/api/auth/refresh
Content-Type: application/json

{
  "refreshToken": "{{refreshTokenFromLogin}}"
}

### Logout
POST {{baseUrl}}/api/auth/logout
Authorization: Bearer {{authToken}}

###############################################
# DASHBOARD APIs - Home Screen
###############################################

### Get Dashboard Data (Home Screen)
GET {{baseUrl}}/api/dashboard
Authorization: Bearer {{authToken}}

### Get User Statistics
GET {{baseUrl}}/api/dashboard/stats
Authorization: Bearer {{authToken}}

###############################################
# EQUIPMENT APIs - Nearby Equipment & Search
###############################################

### Get All Equipment
GET {{baseUrl}}/api/equipment
Authorization: Bearer {{authToken}}

### Get Nearby Available Equipment (Home Screen)
GET {{baseUrl}}/api/equipment/nearby
Authorization: Bearer {{authToken}}

### Get Nearby Wheelchairs Only
GET {{baseUrl}}/api/equipment/nearby?type=wheelchair
Authorization: Bearer {{authToken}}

### Get Nearby Beds Only
GET {{baseUrl}}/api/equipment/nearby?type=bed
Authorization: Bearer {{authToken}}

### Search Equipment (Search Bar)
GET {{baseUrl}}/api/equipment/search?q=wheelchair
Authorization: Bearer {{authToken}}

### Get Equipment by Type
GET {{baseUrl}}/api/equipment?type=wheelchair
Authorization: Bearer {{authToken}}

### Get Available Equipment Only
GET {{baseUrl}}/api/equipment?status=available
Authorization: Bearer {{authToken}}

### Get Equipment by ID
GET {{baseUrl}}/api/equipment/equipment-id-here
Authorization: Bearer {{authToken}}

### Get Equipment Location History
GET {{baseUrl}}/api/equipment/equipment-id-here/location-history
Authorization: Bearer {{authToken}}

### Update Equipment Status
PUT {{baseUrl}}/api/equipment/equipment-id-here/status
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "status": "maintenance"
}

###############################################
# REQUESTS APIs - Active Tasks & Requests
###############################################

### Get All Requests
GET {{baseUrl}}/api/requests
Authorization: Bearer {{authToken}}

### Get Active Tasks (Home Screen - Active Tasks Section)
GET {{baseUrl}}/api/requests/active
Authorization: Bearer {{authToken}}

### Get My Requests (Requests I Created)
GET {{baseUrl}}/api/requests/my-requests
Authorization: Bearer {{authToken}}

### Get Assigned Requests (Requests Assigned to Me)
GET {{baseUrl}}/api/requests/assigned
Authorization: Bearer {{authToken}}

### Get Requests by Status
GET {{baseUrl}}/api/requests?status=pending
Authorization: Bearer {{authToken}}

### Get High Priority Requests
GET {{baseUrl}}/api/requests?priority=2
Authorization: Bearer {{authToken}}

### Get Wheelchair Requests
GET {{baseUrl}}/api/requests?equipment_type=wheelchair
Authorization: Bearer {{authToken}}

### Get Request by ID (Task Detail Screen)
GET {{baseUrl}}/api/requests/request-id-here
Authorization: Bearer {{authToken}}

### Create New Request
# @name createRequest
POST {{baseUrl}}/api/requests
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "patient_name": "John Doe",
  "priority": 1,
  "pickup_room_id": "room-id-here",
  "destination_room_id": "room-id-here",
  "equipment_type": "wheelchair",
  "notes": "Patient needs immediate transfer"
}

### Update Request Status
PUT {{baseUrl}}/api/requests/request-id-here/status
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "status": "in_progress"
}

### Assign Request to Porter
PUT {{baseUrl}}/api/requests/request-id-here/assign
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "porter_id": "porter-user-id-here",
  "equipment_id": "equipment-id-here"
}

### Cancel Request
DELETE {{baseUrl}}/api/requests/request-id-here
Authorization: Bearer {{authToken}}

###############################################
# COMPLETE HOME SCREEN WORKFLOW
###############################################

### Step 1: Login as Nurse
# @name nurseLogin
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "employeecode": "N001",
  "password": "123456"
}

@nurseToken = {{nurseLogin.response.body.data.token}}

### Step 2: Get Dashboard Data (Simulates Home Screen Load)
# This returns:
# - User info (Good Morning, User)
# - Nearby equipment count (12 Within 50 meters)
# - Active tasks list (Wheelchair Required, Bed Transfer Request)
GET {{baseUrl}}/api/dashboard
Authorization: Bearer {{nurseToken}}

### Step 3: Search for Wheelchair
GET {{baseUrl}}/api/equipment/search?q=wheelchair&status=available
Authorization: Bearer {{nurseToken}}

### Step 4: Get Active Tasks Details
GET {{baseUrl}}/api/requests/active
Authorization: Bearer {{nurseToken}}

###############################################
# Role-Based Testing
###############################################

### Admin: Get all users
GET {{baseUrl}}/api/users
Authorization: Bearer {{adminToken}}

### Nurse: Create request
POST {{baseUrl}}/api/requests
Authorization: Bearer {{nurseToken}}
Content-Type: application/json

{
  "patient_name": "Test Patient",
  "priority": 2,
  "pickup_room_id": "room-id",
  "destination_room_id": "room-id",
  "equipment_type": "bed",
  "notes": "High priority transfer"
}

### Porter: Get assigned tasks
GET {{baseUrl}}/api/requests/assigned
Authorization: Bearer {{porterToken}}

###############################################
# Priority Labels for Tasks
###############################################

# Priority values in UI:
# 1 = STAT (Red badge)
# 2 = HIGH (Orange badge)
# 3 = NORMAL (Blue badge)
# 4+ = LOW (Gray badge)

### Get STAT Priority Requests
GET {{baseUrl}}/api/requests?priority=1
Authorization: Bearer {{authToken}}

### Get HIGH Priority Requests
GET {{baseUrl}}/api/requests?priority=2
Authorization: Bearer {{authToken}}

### Get NORMAL Priority Requests
GET {{baseUrl}}/api/requests?priority=3
Authorization: Bearer {{authToken}}

###############################################
# Notes
###############################################

# Default Test Accounts (from schema):
# - Nurse:  N001 / 123456
# - Porter: P001 / 123456
# - Admin:  A001 / admin123

# Home Screen Data:
# GET /api/dashboard - Returns all home screen data in one call
# GET /api/equipment/nearby - Returns nearby equipment count
# GET /api/requests/active - Returns active tasks list

# Search Functionality:
# GET /api/equipment/search?q=wheelchair - Search equipment
# GET /api/equipment/nearby?type=wheelchair - Filter by type
